<script lang="ts">
  import { getImageComponentStyles } from "./image-utils";
  import { stringifyStyles } from "../../utils";
  import type { ImageProps } from "../../data/entities";

  const { id, colorMode, source, ...restProps }: ImageProps = $props();

  const { gradientStyles, imageStyles } = $derived(
    getImageComponentStyles({ id, colorMode, source, ...restProps }),
  );
  const gradientStylesString = $derived(stringifyStyles(gradientStyles));
  const imageStylesString = $derived(stringifyStyles(imageStyles));
</script>

<div
  class="image-container"
  id={`image-container-${id}`}
  style={imageStylesString}
>
  <img class="image" src={source[colorMode || "light"]?.original} alt="" {id} />
  <span class="image-overlay" style={gradientStylesString}></span>
</div>

<style>
  .image-container {
    position: relative;
    height: var(--height, unset);
    width: var(--width, unset);
    overflow: hidden;
    border-radius: var(--corner-radius, unset);
    clip-path: var(--clip-path, unset);
    display: flex;
    flex: 1 0 auto;
  }
  .image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .image-overlay {
    position: absolute;
    inset: 0;
    background: var(--background, unset);
  }
</style>
