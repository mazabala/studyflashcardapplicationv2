<script lang="ts">
  import {
    Stack,
    Text,
    Button,
    Image,
    PurchaseButton,
    Package,
    Footer,
  } from "../..";
  import Self from "./Node.svelte";
  import {
    type ActionsProps,
    type ComponentLocalizations,
    type Extra,
    type PaywallComponent,
    type PurchaseStateProps,
    type SupportedActions,
  } from "../../data/entities";
  import { prefersDarkMode } from "../../stores/theme";
  import ButtonNode from "../button/ButtonNode.svelte";
  import type { PurchaseState } from "../../data/state";

  interface Props extends ActionsProps, PurchaseStateProps {
    nodeData: PaywallComponent;
    labels: ComponentLocalizations;
    onAction?: (action: SupportedActions, data?: Extra) => void;
    purchaseState?: PurchaseState;
  }

  const { nodeData, labels, onAction, purchaseState }: Props = $props();

  const ComponentTypes = {
    text: Text,
    stack: Stack,
    image: Image,
    button: ButtonNode,
    purchase_button: PurchaseButton,
    package: Package,
    footer: Footer,
  };
  const MyComponent = $derived(ComponentTypes[nodeData.type]);
</script>

<MyComponent
  {...(nodeData as any) || {}}
  {labels}
  prefersDarkMode={$prefersDarkMode}
  {onAction}
  {purchaseState}
>
  {#each nodeData.components as childData}
    <Self nodeData={childData} {labels} {onAction} {purchaseState} />
  {/each}
</MyComponent>
