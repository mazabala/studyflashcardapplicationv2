<script module lang="ts">
  import { defineMeta } from "@storybook/addon-svelte-csf";
  import ButtonNode from "./ButtonNode.svelte";
  import { colorModeStoryMeta } from "../../stories/meta-templates";
  import type { SupportedActions, TextProps } from "../../data/entities";

  const onAction = (action: SupportedActions) => {
    alert(action.type);
  };

  const { Story } = defineMeta({
    title: "Components/Button",
    component: ButtonNode,
    tags: ["autodocs"],
    argTypes: {
      action: {
        control: { type: "object" },
        description: "Action configuration for the button",
        table: {
          type: {
            summary: "object",
            detail: `{
              type: "restore_purchases" | "navigate_back" | "navigate_to",
              destination?: "customer_center" | "privacy_policy" | "terms" | "url",
              url?: {
                url_lid: string,
                method: "in_app_browser" | "external_browser" | "deep_link"
              }
            }`,
          },
        },
      },
      colorMode: colorModeStoryMeta,
      stack: {
        control: { type: "object" },
        description: "Stack configuration for button content",
        table: {
          type: {
            summary: "object",
            detail: "StackProps",
          },
        },
      },
    },
  });

  const purchaseState = {
    locale: "en_US",
    defaultLocale: "en_US",
  };

  export const labelsData = {
    en_US: {
      id1: "Restore purchases",
      id2: "Navigate back",
      id3: "Navigate to",
      id4: "URL navigation",
    },
  };

  const textProps = (id: number) => ({
    type: "text",
    name: "Button Text",
    components: [],
    id: "button-text-1",
    text_lid: `id${id}`,
    font_weight: "medium",
    horizontal_alignment: "center",
    background_color: {
      dark: { type: "hex", value: "transparent" },
      light: { type: "hex", value: "transparent" },
    },
    color: {
      dark: { type: "hex", value: "#000000" },
      light: { type: "hex", value: "#ffffff" },
    },
    font_size: "body_m",
    margin: { top: 0, trailing: 0, bottom: 0, leading: 0 },
    padding: { top: 0, trailing: 0, bottom: 0, leading: 0 },
    labels: labelsData,
    colorMode: "light",
    size: {
      width: { type: "fit" },
      height: { type: "fit" },
    },
  });

  const baseStackProps = {
    type: "stack",
    size: { width: { type: "fill" }, height: { type: "fill" } },
    labels: labelsData,
    dimension: {
      type: "horizontal",
      alignment: "center",
      distribution: "center",
    },
    components: [],
    spacing: 16,
    padding: { top: 16, trailing: 16, bottom: 16, leading: 16 },
    margin: { top: 0, trailing: 0, bottom: 0, leading: 0 },
    shape: { type: "pill" },
    id: "vertical-stack",
    name: "Vertical Stack",
    background_color: {
      dark: { type: "hex", value: "#3471eb" },
      light: { type: "hex", value: "#3471eb" },
    },
  };
</script>

<!-- Restore purchases -->
<Story
  name="Restore purchases"
  args={{
    type: "button",
    action: { type: "restore_purchases" },
    labels: labelsData,
    stack: {
      ...baseStackProps,
      components: [textProps(1)],
    },
    purchaseState: purchaseState,
    onAction,
  }}
/>

<!-- Navigate Back story -->
<Story
  name="Navigate Back"
  args={{
    type: "button",
    action: { type: "navigate_back" },
    onAction,
    labels: labelsData,
    stack: {
      ...baseStackProps,
      shape: {
        type: "rectangle",
        corners: {
          top_leading: 16,
          top_trailing: 16,
          bottom_leading: 16,
          bottom_trailing: 16,
        },
      },
      background_color: {
        dark: { type: "hex", value: "#2E7D32" },
        light: { type: "hex", value: "#2E7D32" },
      },
      components: [textProps(2)],
    },
    purchaseState: purchaseState,
  }}
/>

<!-- Navigate To story -->
<Story
  name="Navigate To"
  args={{
    type: "button",
    labels: labelsData,
    action: {
      type: "navigate_to",
      destination: "customer_center",
    },
    onAction,
    stack: {
      ...baseStackProps,
      shape: {
        type: "rectangle",
        corners: {
          top_leading: 8,
          top_trailing: 8,
          bottom_leading: 8,
          bottom_trailing: 8,
        },
      },
      background_color: {
        dark: { type: "hex", value: "#D32F2F" },
        light: { type: "hex", value: "#D32F2F" },
      },
      components: [textProps(3)],
    },
    purchaseState: purchaseState,
  }}
/>

<!-- URL Navigation story -->
<Story
  name="URL Navigation"
  args={{
    type: "button",
    labels: labelsData,
    action: {
      type: "navigate_to",
      destination: "url",
      url: {
        url_lid: "terms_url",
        method: "in_app_browser",
      },
    },
    onAction,
    stack: {
      ...baseStackProps,
      background_color: {
        dark: { type: "hex", value: "#4A90E2" },
        light: { type: "hex", value: "#4A90E2" },
      },
      components: [textProps(4)],
    },
    purchaseState: purchaseState,
  }}
/>
